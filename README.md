# PsychoModels

This project establishes a database of formal models in psychology.
The website is written in Python using the Django framework.

### Pipenv

This project uses pipenv to manage dependencies. See https://pipenv.pypa.io/en/latest/index.html for installation
instructions. To install the dependencies, run:

```bash
pipenv install "PACKAGE_NAME"
pipenv install --dev "DEV_PACKAGE_NAME"
```

## Setup

You can run the project on your local machine by following the steps outlined below.

Install pipenv on your machine.

Install the dependencies for this project if you haven't installed them yet:

```bash
$ pipenv install
```

Also install the dev dependencies (for linting and formatting) by running

```bash
$ pipenv install --dev
```

Make and apply the migrations for the project to build your local database:

```bash
$ pipenv run python manage.py makemigrations
$ pipenv run python manage.py migrate
```

For the frontend assets (js and css), you need to install node.js and yarn on your machine. Then run the vite and
tailwind dev server by running:

```bash
$ yarn install
$ yarn start
```

The vite dev server must be running in order for the python runserver command to work. Else you can expect a Vite dev
server is not started! error.

Run the Django development server:

```bash
$ pipenv run python manage.py runserver
```

## Fixtures

You can load the initial data for development by running:

```bash
$ pipenv run python manage.py loaddata author publication programming_language software_package framework psychology_discipline
```

The fixuture data is generated by ChatGPT so expect it to be wrong.

## Linting

This project uses [Black]((https://github.com/psf/black)) for linting and formatting. Configure your editor to use Black
for formatting. To lint the project, run:

```bash
$ pipenv run black .
```

Pre-commit hooks are configured to run black on the staged files for every commit. You can skip the pre-commit hooks by
adding the `--no-verify` flag to your commit command.

The linting check is also run on the CI pipeline using Github actions.

## Database schema

To visualize the database schema you can use https://dbdiagram.io/. Export the schema by running:

```bash
pg_dump -h 127.0.0.1 -p 5432 -d psychomodels -U postgres -s -F p -E UTF-8 -f schema.sql
```

To only export the schema for the psychology_models app run:

```bash
# Initialize an empty variable to hold the table options
TABLE_OPTIONS=""

# Get the list of table names that match the pattern
TABLES=$(psql -h 127.0.0.1 -p 5432 -d psychomodels -U postgres -t -c "SELECT tablename FROM pg_tables WHERE tablename LIKE 'psychology_models_%';")

# Trim whitespace and iterate over each table
for table in $TABLES; do
    TABLE_OPTIONS="$TABLE_OPTIONS --table=$table"
done

# Check if TABLE_OPTIONS is not empty
if [ -z "$TABLE_OPTIONS" ]; then
    echo "No matching tables found."
    exit 1
fi

# Run pg_dump with the constructed table options
pg_dump -h 127.0.0.1 -p 5432 -d psychomodels -U postgres -s -F p -E UTF-8 -f schema.sql $TABLE_OPTIONS
```
